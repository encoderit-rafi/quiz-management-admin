import{a3 as y,A as C,F as _,G as m,E as x,aw as w,ax as k,j as a,a as D,ay as S,N as A,az as U,r as B,B as F}from"./index-CDJ7DgKs.js";import{C as q,b as E,c as Q,d as N,e as T,u as P,a as I}from"./field-B7Wg_fYW.js";import{u as K}from"./use-get-quiz.api-CQ2huGEi.js";import{F as z}from"./form-image-upload-CeIFgKT8.js";import{F as f}from"./form-input-BDk7ste-.js";import"./password-input-DfsXY_sW.js";import{F as L}from"./form-tiptap-cVp5Newj.js";import{b as O,c as $}from"./card-DinPMtRP.js";const G=i=>{const e=new FormData;return Object.entries(i).forEach(([t,r])=>{r!=null&&(r instanceof File?e.append(t,r):typeof r=="boolean"?e.append(t,r?"1":"0"):e.append(t,String(r)))}),e},V=i=>Object.fromEntries(Object.entries(i).filter(([e,t])=>t!=null&&t!=="")),H=()=>{const i=y();return C({mutationKey:["create-quiz"],mutationFn:e=>{if(e instanceof FormData)return x.post("/quizzes",e,{headers:{"Content-Type":"multipart/form-data"}});const t=V({...e,is_active:e.is_active?1:0}),r=t.logo instanceof File||t.background_image instanceof File,s=r?G(t):t;return x.post("/quizzes",s,{headers:r?{"Content-Type":"multipart/form-data"}:void 0})},onSuccess:()=>{m.success("Quiz created successfully!"),i.invalidateQueries({queryKey:["quizzes"]})},onError:e=>{const t="Failed to create quiz.";_(e)?m.error(e.response?.data?.message||e.message||t):m.error(t)}})},M=()=>{const i=y();return C({mutationKey:["update-quiz"],mutationFn:e=>{if(e instanceof FormData){const l=e.get("id");return x.post(`/quizzes/${l}`,e,{headers:{"Content-Type":"multipart/form-data"}})}const{id:t,...r}=e,s=w({...r,is_active:e.is_active?1:0}),n=s.logo instanceof File||s.background_image instanceof File,c=n?k.serialize(s):s;return x.post(`/quizzes/${t}`,c,{headers:n?{"Content-Type":"multipart/form-data"}:void 0})},onSuccess:()=>{m.success("Quiz updated successfully!"),i.invalidateQueries({queryKey:["quizzes"]}),i.invalidateQueries({queryKey:["quiz"]})},onError:e=>{const t="Failed to update quiz.";_(e)?m.error(e.response?.data?.message||e.message||t):m.error(t)}})};function R({className:i,...e}){return a.jsx("textarea",{"data-slot":"textarea",className:D("border-input placeholder:text-sm placeholder:font-light placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),...e})}const Z=({name:i,control:e,label:t="",placeholder:r="",description:s=""})=>a.jsx(q,{control:e,name:i,render:({field:n,fieldState:c})=>{const{name:l}=n,{invalid:o,error:d}=c;return a.jsxs(E,{"data-invalid":o,children:[!!t&&a.jsx(Q,{htmlFor:l,children:t}),a.jsx(R,{id:l,...n,placeholder:r,rows:4,value:n.value??"","aria-invalid":o}),!!s&&!o&&a.jsx(N,{children:s}),o&&a.jsx(T,{errors:[d]})]})}}),v=({name:i,control:e,label:t="",placeholder:r="#000000",description:s="",defaultColor:n="#000000"})=>a.jsx(q,{control:e,name:i,render:({field:c,fieldState:l})=>{const{name:o,value:d,onChange:g}=c,{invalid:u,error:h}=l,b=d||n;return a.jsxs(E,{"data-invalid":u,children:[!!t&&a.jsx(Q,{htmlFor:o,children:t}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"color",value:b,onChange:p=>g(p.target.value),className:"h-full w-16 cursor-pointer"}),a.jsx(S,{...c,id:o,value:d||"",placeholder:r,"aria-invalid":u,className:"flex-1"})]}),!!s&&!u&&a.jsx(N,{className:"text-sm font-light",children:s}),u&&a.jsx(T,{errors:[h]})]})}}),J={id:void 0,title:"",quiz_name:"",heading:"",cta_text:"",footer_text:"",description:"",logo:null,background_image:null,primary_color:"#ffffff",secondary_color:"#ffffff",is_active:!0};function oe({form_data:i,onSuccess:e,onCancel:t}){const{id:r,type:s}=i,{data:n}=A({...K(r),enabled:!!r&&s==="update"}),c=P({resolver:I(U),defaultValues:J}),{reset:l,control:o,handleSubmit:d}=c;B.useEffect(()=>{s==="update"&&n&&l(n)},[n,s,l]);const{mutate:g,isPending:u}=H(),{mutate:h,isPending:b}=M(),p=j=>{s==="update"?h(j,{onSuccess:()=>{e(),l()}}):g(j,{onSuccess:()=>{e(),l()}})};return a.jsxs(O,{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsx("form",{onSubmit:d(p),className:"space-y-6 flex-1 overflow-y-auto p-1 pr-4",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4  bg-muted/5",children:[a.jsx(f,{name:"quiz_name",control:o,label:"Quiz Name",placeholder:"Enter quiz name"}),a.jsx(f,{name:"title",control:o,label:"Title",placeholder:"Enter quiz title"}),a.jsx(f,{name:"heading",control:o,label:"Heading",placeholder:"Enter heading"}),a.jsx(f,{name:"cta_text",control:o,label:"CTA Text",placeholder:"Enter CTA text"}),a.jsx(z,{name:"logo",control:o,label:"Logo",description:"Upload logo here."}),a.jsx(z,{name:"background_image",control:o,label:"Background Image",description:"Upload background image here."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4  bg-muted/5",children:[a.jsx(v,{control:o,name:"primary_color",label:"Primary Color",placeholder:"#3b82f6",defaultColor:"#3b82f6"}),a.jsx(v,{name:"secondary_color",control:o,label:"Secondary Color",placeholder:"#8b5cf6",defaultColor:"#8b5cf6"})]}),a.jsx(Z,{name:"description",control:o,label:"Description",placeholder:"Enter description"}),a.jsx(L,{name:"footer_text",control:o,label:"Footer Text"})]})}),a.jsxs($,{className:"pt-4 w-full flex justify-end items-center gap-2",children:[a.jsx(F,{type:"button",variant:"outline",className:"min-w-36",onClick:t,children:"Cancel"}),a.jsx(F,{type:"button",className:"min-w-36",onClick:d(p),loading:u||b,children:s==="update"?"Update":"Create"})]})]})}export{oe as F};
