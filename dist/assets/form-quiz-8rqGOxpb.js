import{c as U,W as E,q as k,v as Q,w as f,t as j,ao as S,ap as B,j as e,a as y,r as v,B as b,ah as D,aq as P,E as L,ar as A}from"./index-C0O9Q7MJ.js";import{C as z,b as F,c as C,e as w,d as T,u as I,a as K}from"./field-wCSYO7Ng.js";import{u as O}from"./use-get-quiz.api-NMv-U-t5.js";import{F as g}from"./form-input-BTBxnoh2.js";import"./password-input-BRREzLrV.js";import{F as R}from"./form-tiptap-CfJxgdsj.js";import{c as $,d as M}from"./card-DH7LzJZY.js";const H=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],V=U("upload",H),G=n=>{const a=new FormData;return Object.entries(n).forEach(([t,s])=>{s!=null&&(s instanceof File?a.append(t,s):typeof s=="boolean"?a.append(t,s?"1":"0"):a.append(t,String(s)))}),a},W=n=>Object.fromEntries(Object.entries(n).filter(([a,t])=>t!=null&&t!=="")),Z=()=>{const n=E();return k({mutationKey:["create-quiz"],mutationFn:a=>{if(a instanceof FormData)return j.post("/quizzes",a,{headers:{"Content-Type":"multipart/form-data"}});const t=W({...a,is_active:a.is_active?1:0}),s=t.logo instanceof File||t.background_image instanceof File,o=s?G(t):t;return j.post("/quizzes",o,{headers:s?{"Content-Type":"multipart/form-data"}:void 0})},onSuccess:()=>{f.success("Quiz created successfully!"),n.invalidateQueries({queryKey:["quizzes"]})},onError:a=>{const t="Failed to create quiz.";Q(a)?f.error(a.response?.data?.message||a.message||t):f.error(t)}})},J=()=>{const n=E();return k({mutationKey:["update-quiz"],mutationFn:a=>{if(a instanceof FormData){const c=a.get("id");return j.post(`/quizzes/${c}`,a,{headers:{"Content-Type":"multipart/form-data"}})}const{id:t,...s}=a,o=S({...s,is_active:a.is_active?1:0}),i=o.logo instanceof File||o.background_image instanceof File,l=i?B.serialize(o):o;return j.post(`/quizzes/${t}`,l,{headers:i?{"Content-Type":"multipart/form-data"}:void 0})},onSuccess:()=>{f.success("Quiz updated successfully!"),n.invalidateQueries({queryKey:["quizzes"]}),n.invalidateQueries({queryKey:["quiz"]})},onError:a=>{const t="Failed to update quiz.";Q(a)?f.error(a.response?.data?.message||a.message||t):f.error(t)}})},X=({src:n,alt:a="Preview",className:t,...s})=>e.jsx("img",{src:n,alt:a,className:y("h-full w-full object-cover object-center",t),...s}),N=({name:n,control:a,label:t="",description:s="upload image here."})=>e.jsx(z,{control:a,name:n,render:({field:o,fieldState:i})=>{const{value:l,onChange:c}=o,{invalid:r,error:u}=i,[m,d]=v.useState(null);return v.useEffect(()=>{if(l instanceof File){const p=URL.createObjectURL(l);return d(p),()=>URL.revokeObjectURL(p)}else d(typeof l=="string"?l:null)},[l]),e.jsxs(F,{"data-invalid":r,children:[!!t&&e.jsx(C,{children:t}),e.jsx("div",{className:"space-y-2 h-full",children:e.jsxs("label",{className:y("flex flex-col gap-4 items-center justify-center text-muted-foreground w-full h-full aspect-video rounded-md cursor-pointer hover:bg-accent/50 transition-colors overflow-hidden",{"border-dashed border":!m}),children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",disabled:!!m,onChange:p=>{const x=p.target.files?.[0]||null;c(x)}}),m?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx(X,{src:m,alt:`${t} preview`}),e.jsx(b,{type:"button",variant:"destructive",size:"icon",className:`absolute top-2 right-2 rounded-full size-6
                    `,onClick:()=>c(null),children:e.jsx(D,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"size-5 shrink-0"}),e.jsx("p",{className:"text-sm text-center whitespace-nowrap truncate max-w-full",children:s})]})]})}),r&&e.jsx(w,{errors:[u]})]})}});function Y({className:n,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:y("border-input placeholder:text-sm placeholder:font-light placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),...a})}const ee=({name:n,control:a,label:t="",placeholder:s="",description:o=""})=>e.jsx(z,{control:a,name:n,render:({field:i,fieldState:l})=>{const{name:c}=i,{invalid:r,error:u}=l;return e.jsxs(F,{"data-invalid":r,children:[!!t&&e.jsx(C,{htmlFor:c,children:t}),e.jsx(Y,{id:c,...i,placeholder:s,rows:4,value:i.value??"","aria-invalid":r}),!!o&&!r&&e.jsx(T,{children:o}),r&&e.jsx(w,{errors:[u]})]})}}),_=({name:n,control:a,label:t="",placeholder:s="#000000",description:o="",defaultColor:i="#000000"})=>e.jsx(z,{control:a,name:n,render:({field:l,fieldState:c})=>{const{name:r,value:u,onChange:m}=l,{invalid:d,error:p}=c,x=u||i;return e.jsxs(F,{"data-invalid":d,children:[!!t&&e.jsx(C,{htmlFor:r,children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:x,onChange:h=>m(h.target.value),className:"h-full w-16 cursor-pointer"}),e.jsx(P,{...l,id:r,value:u||"",placeholder:s,"aria-invalid":d,className:"flex-1"})]}),!!o&&!d&&e.jsx(T,{className:"text-sm font-light",children:o}),d&&e.jsx(w,{errors:[p]})]})}}),ae={id:void 0,title:"",quiz_name:"",heading:"",cta_text:"",footer_text:"",description:"",logo:null,background_image:null,primary_color:"#ffffff",secondary_color:"#ffffff",is_active:!0};function ce({form_data:n,onSuccess:a,onCancel:t}){const{id:s,type:o}=n,{data:i}=L({...O(s),enabled:!!s&&o==="update"}),l=I({resolver:K(A),defaultValues:ae}),{reset:c,control:r,handleSubmit:u}=l;v.useEffect(()=>{o==="update"&&i&&c(i)},[i,o,c]);const{mutate:m,isPending:d}=Z(),{mutate:p,isPending:x}=J(),h=q=>{o==="update"?p(q,{onSuccess:()=>{a(),c()}}):m(q,{onSuccess:()=>{a(),c()}})};return e.jsxs($,{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("form",{onSubmit:u(h),className:"space-y-6 flex-1 overflow-y-auto p-1 pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4  bg-muted/5",children:[e.jsx(g,{name:"quiz_name",control:r,label:"Quiz Name",placeholder:"Enter quiz name"}),e.jsx(g,{name:"title",control:r,label:"Title",placeholder:"Enter quiz title"}),e.jsx(g,{name:"heading",control:r,label:"Heading",placeholder:"Enter heading"}),e.jsx(g,{name:"cta_text",control:r,label:"CTA Text",placeholder:"Enter CTA text"}),e.jsx(N,{name:"logo",control:r,label:"Logo",description:"Upload logo here."}),e.jsx(N,{name:"background_image",control:r,label:"Background Image",description:"Upload background image here."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4  bg-muted/5",children:[e.jsx(_,{control:r,name:"primary_color",label:"Primary Color",placeholder:"#3b82f6",defaultColor:"#3b82f6"}),e.jsx(_,{name:"secondary_color",control:r,label:"Secondary Color",placeholder:"#8b5cf6",defaultColor:"#8b5cf6"})]}),e.jsx(ee,{name:"description",control:r,label:"Description",placeholder:"Enter description"}),e.jsx(R,{name:"footer_text",control:r,label:"Footer Text"})]})}),e.jsxs(M,{className:"pt-4 w-full flex justify-end items-center gap-2",children:[e.jsx(b,{type:"button",variant:"outline",className:"min-w-36",onClick:t,children:"Cancel"}),e.jsx(b,{type:"button",className:"min-w-36",onClick:u(h),loading:d||x,children:o==="update"?"Update":"Create"})]})]})}export{ce as F};
