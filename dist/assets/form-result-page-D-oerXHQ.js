import{a3 as q,A as G,F as Q,G as j,E as X,r as m,a4 as pe,j as l,a5 as ge,a6 as he,a7 as _,a8 as F,a9 as D,aa as Se,ab as W,ac as xe,ad as ve,a as V,ae as be,B as we,af as ye,ag as Re}from"./index-CDJ7DgKs.js";import{C as Pe,b as Ce,c as Ee,d as _e,e as je,u as De,a as Me}from"./field-B7Wg_fYW.js";import{F as Ae}from"./form-input-BDk7ste-.js";import"./password-input-DfsXY_sW.js";import{F as Ke}from"./form-tiptap-cVp5Newj.js";import{b as Ne,c as Fe}from"./card-DinPMtRP.js";const Be=()=>{const e=q();return G({mutationFn:async t=>(await X.post("/result-pages",t)).data,onSuccess:()=>{j.success("Result page created successfully!"),e.invalidateQueries({queryKey:["result-pages"]})},onError:t=>{const n="Failed to create result page.";Q(t)?j.error(t.response?.data?.message||t.message||n):j.error(n)}})},Ie=()=>{const e=q();return G({mutationFn:async t=>(await X.put(`/result-pages/${t.id}`,t)).data,onSuccess:()=>{j.success("Result page updated successfully!"),e.invalidateQueries({queryKey:["result-pages"]})},onError:t=>{const n="Failed to update result page.";Q(t)?j.error(t.response?.data?.message||t.message||n):j.error(n)}})};var J=["PageUp","PageDown"],Z=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ee={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},M="Slider",[H,Te,ke]=he(M),[te]=ge(M,[ke]),[ze,B]=te(M),ne=m.forwardRef((e,t)=>{const{name:n,min:o=0,max:r=100,step:c=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:u=0,defaultValue:h=[o],value:p,onValueChange:i=()=>{},onValueCommit:d=()=>{},inverted:g=!1,form:v,...f}=e,S=m.useRef(new Set),x=m.useRef(0),w=s==="horizontal"?Ve:He,[b=[],A]=pe({prop:p,defaultProp:h,onChange:y=>{[...S.current][x.current]?.focus(),i(y)}}),I=m.useRef(b);function T(y){const R=Ye(b,y);K(y,R)}function me(y){K(y,x.current)}function fe(){const y=I.current[x.current];b[x.current]!==y&&d(b)}function K(y,R,{commit:k}={commit:!1}){const $=Xe(c),z=We(Math.round((y-o)/c)*c+o,$),N=W(z,[o,r]);A((E=[])=>{const P=Ue(E,N,R);if(Qe(P,u*c)){x.current=P.indexOf(N);const Y=String(P)!==String(E);return Y&&k&&d(P),Y?P:E}else return E})}return l.jsx(ze,{scope:e.__scopeSlider,name:n,disabled:a,min:o,max:r,valueIndexToChangeRef:x,thumbs:S.current,values:b,orientation:s,form:v,children:l.jsx(H.Provider,{scope:e.__scopeSlider,children:l.jsx(H.Slot,{scope:e.__scopeSlider,children:l.jsx(w,{"aria-disabled":a,"data-disabled":a?"":void 0,...f,ref:t,onPointerDown:_(f.onPointerDown,()=>{a||(I.current=b)}),min:o,max:r,inverted:g,onSlideStart:a?void 0:T,onSlideMove:a?void 0:me,onSlideEnd:a?void 0:fe,onHomeKeyDown:()=>!a&&K(o,0,{commit:!0}),onEndKeyDown:()=>!a&&K(r,b.length-1,{commit:!0}),onStepKeyDown:({event:y,direction:R})=>{if(!a){const z=J.includes(y.key)||y.shiftKey&&Z.includes(y.key)?10:1,N=x.current,E=b[N],P=c*z*R;K(E+P,N,{commit:!0})}}})})})})});ne.displayName=M;var[oe,re]=te(M,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Ve=m.forwardRef((e,t)=>{const{min:n,max:o,dir:r,inverted:c,onSlideStart:s,onSlideMove:a,onSlideEnd:u,onStepKeyDown:h,...p}=e,[i,d]=m.useState(null),g=D(t,w=>d(w)),v=m.useRef(void 0),f=Se(r),S=f==="ltr",x=S&&!c||!S&&c;function C(w){const b=v.current||i.getBoundingClientRect(),A=[0,b.width],T=U(A,x?[n,o]:[o,n]);return v.current=b,T(w-b.left)}return l.jsx(oe,{scope:e.__scopeSlider,startEdge:x?"left":"right",endEdge:x?"right":"left",direction:x?1:-1,size:"width",children:l.jsx(se,{dir:f,"data-orientation":"horizontal",...p,ref:g,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const b=C(w.clientX);s?.(b)},onSlideMove:w=>{const b=C(w.clientX);a?.(b)},onSlideEnd:()=>{v.current=void 0,u?.()},onStepKeyDown:w=>{const A=ee[x?"from-left":"from-right"].includes(w.key);h?.({event:w,direction:A?-1:1})}})})}),He=m.forwardRef((e,t)=>{const{min:n,max:o,inverted:r,onSlideStart:c,onSlideMove:s,onSlideEnd:a,onStepKeyDown:u,...h}=e,p=m.useRef(null),i=D(t,p),d=m.useRef(void 0),g=!r;function v(f){const S=d.current||p.current.getBoundingClientRect(),x=[0,S.height],w=U(x,g?[o,n]:[n,o]);return d.current=S,w(f-S.top)}return l.jsx(oe,{scope:e.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:l.jsx(se,{"data-orientation":"vertical",...h,ref:i,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const S=v(f.clientY);c?.(S)},onSlideMove:f=>{const S=v(f.clientY);s?.(S)},onSlideEnd:()=>{d.current=void 0,a?.()},onStepKeyDown:f=>{const x=ee[g?"from-bottom":"from-top"].includes(f.key);u?.({event:f,direction:x?-1:1})}})})}),se=m.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:o,onSlideMove:r,onSlideEnd:c,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:u,...h}=e,p=B(M,n);return l.jsx(F.span,{...h,ref:t,onKeyDown:_(e.onKeyDown,i=>{i.key==="Home"?(s(i),i.preventDefault()):i.key==="End"?(a(i),i.preventDefault()):J.concat(Z).includes(i.key)&&(u(i),i.preventDefault())}),onPointerDown:_(e.onPointerDown,i=>{const d=i.target;d.setPointerCapture(i.pointerId),i.preventDefault(),p.thumbs.has(d)?d.focus():o(i)}),onPointerMove:_(e.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&r(i)}),onPointerUp:_(e.onPointerUp,i=>{const d=i.target;d.hasPointerCapture(i.pointerId)&&(d.releasePointerCapture(i.pointerId),c(i))})})}),ae="SliderTrack",ie=m.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,r=B(ae,n);return l.jsx(F.span,{"data-disabled":r.disabled?"":void 0,"data-orientation":r.orientation,...o,ref:t})});ie.displayName=ae;var L="SliderRange",le=m.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,r=B(L,n),c=re(L,n),s=m.useRef(null),a=D(t,s),u=r.values.length,h=r.values.map(d=>ue(d,r.min,r.max)),p=u>1?Math.min(...h):0,i=100-Math.max(...h);return l.jsx(F.span,{"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,...o,ref:a,style:{...e.style,[c.startEdge]:p+"%",[c.endEdge]:i+"%"}})});le.displayName=L;var O="SliderThumb",ce=m.forwardRef((e,t)=>{const n=Te(e.__scopeSlider),[o,r]=m.useState(null),c=D(t,a=>r(a)),s=m.useMemo(()=>o?n().findIndex(a=>a.ref.current===o):-1,[n,o]);return l.jsx(Le,{...e,ref:c,index:s})}),Le=m.forwardRef((e,t)=>{const{__scopeSlider:n,index:o,name:r,...c}=e,s=B(O,n),a=re(O,n),[u,h]=m.useState(null),p=D(t,C=>h(C)),i=u?s.form||!!u.closest("form"):!0,d=xe(u),g=s.values[o],v=g===void 0?0:ue(g,s.min,s.max),f=$e(o,s.values.length),S=d?.[a.size],x=S?qe(S,v,a.direction):0;return m.useEffect(()=>{if(u)return s.thumbs.add(u),()=>{s.thumbs.delete(u)}},[u,s.thumbs]),l.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${x}px)`},children:[l.jsx(H.ItemSlot,{scope:e.__scopeSlider,children:l.jsx(F.span,{role:"slider","aria-label":e["aria-label"]||f,"aria-valuemin":s.min,"aria-valuenow":g,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...c,ref:p,style:g===void 0?{display:"none"}:e.style,onFocus:_(e.onFocus,()=>{s.valueIndexToChangeRef.current=o})})}),i&&l.jsx(de,{name:r??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:g},o)]})});ce.displayName=O;var Oe="RadioBubbleInput",de=m.forwardRef(({__scopeSlider:e,value:t,...n},o)=>{const r=m.useRef(null),c=D(r,o),s=ve(t);return m.useEffect(()=>{const a=r.current;if(!a)return;const u=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(u,"value").set;if(s!==t&&p){const i=new Event("input",{bubbles:!0});p.call(a,t),a.dispatchEvent(i)}},[s,t]),l.jsx(F.input,{style:{display:"none"},...n,ref:c,defaultValue:t})});de.displayName=Oe;function Ue(e=[],t,n){const o=[...e];return o[n]=t,o.sort((r,c)=>r-c)}function ue(e,t,n){const c=100/(n-t)*(e-t);return W(c,[0,100])}function $e(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Ye(e,t){if(e.length===1)return 0;const n=e.map(r=>Math.abs(r-t)),o=Math.min(...n);return n.indexOf(o)}function qe(e,t,n){const o=e/2,c=U([0,50],[0,o]);return(o-c(t)*n)*n}function Ge(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function Qe(e,t){if(t>0){const n=Ge(e);return Math.min(...n)>=t}return!0}function U(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(n-e[0])}}function Xe(e){return(String(e).split(".")[1]||"").length}function We(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var Je=ne,Ze=ie,et=le,tt=ce;function nt({className:e,defaultValue:t,value:n,min:o=0,max:r=100,...c}){const s=m.useMemo(()=>Array.isArray(n)?n:Array.isArray(t)?t:[o,r],[n,t,o,r]);return l.jsxs(Je,{"data-slot":"slider",defaultValue:t,value:n,min:o,max:r,className:V("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",e),...c,children:[l.jsx(Ze,{"data-slot":"slider-track",className:V("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:l.jsx(et,{"data-slot":"slider-range",className:V("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:s.length},(a,u)=>l.jsx(tt,{"data-slot":"slider-thumb",className:"border-primary ring-ring/50 block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},u))]})}const ot=({name:e,control:t,label:n="",description:o="",min:r=0,max:c=100,step:s=1,defaultValue:a=[0,100],showValue:u=!0,formatValue:h})=>l.jsx(Pe,{control:t,name:e,render:({field:p,fieldState:i})=>{const{value:d,onChange:g}=p,{invalid:v,error:f}=i,S=h?h(d||a):`${(d||a)[0]} - ${(d||a)[1]}`;return l.jsxs(Ce,{"data-invalid":v,children:[!!n&&l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx(Ee,{children:n}),u&&l.jsx("span",{className:"text-sm text-muted-foreground font-mono",children:S})]}),l.jsx("div",{className:"pt-2",children:l.jsx(nt,{defaultValue:a,min:r,max:c,step:s,value:d||a,onValueChange:g,className:"py-4","aria-invalid":v})}),!!o&&!v&&l.jsx(_e,{children:o}),v&&l.jsx(je,{errors:[f]})]})}}),rt=be.omit({min_score:!0,max_score:!0}).extend({score_range:ye(Re()).length(2)}),ut=({initialData:e,type:t="create",onSuccess:n})=>{const o=De({resolver:Me(rt),defaultValues:{name:e?.name||"",score_range:[e?.min_score||0,e?.max_score||100],content:e?.content||""}}),{control:r,handleSubmit:c}=o,{mutate:s,isPending:a}=Be(),{mutate:u,isPending:h}=Ie(),p=d=>{const{score_range:g,...v}=d,f={...v,min_score:g[0],max_score:g[1]};t==="update"&&e?.id?(f.id=e.id,u(f,{onSuccess:n})):s(f,{onSuccess:n})},i=a||h;return l.jsxs(Ne,{className:"flex-1 flex flex-col overflow-hidden",children:[l.jsx("form",{id:"result-page-form",onSubmit:c(p),className:"space-y-6 flex-1 overflow-y-auto p-1 pr-4",children:l.jsxs("div",{className:"grid gap-4",children:[l.jsx(Ae,{name:"name",control:r,label:"Page Name",placeholder:"e.g. High Score Result"}),l.jsx(ot,{name:"score_range",control:r,label:"Score Range",min:0,max:100,step:1,description:"Define the percentage range (0-100) for which this result page should be shown.",formatValue:d=>`${d[0]} - ${d[1]}%`}),l.jsx(Ke,{name:"content",control:r,label:"Page Content",description:"Design your result page content here."})]})}),l.jsx(Fe,{className:"pt-4 w-full flex justify-end items-center gap-2",children:l.jsx(we,{type:"submit",form:"result-page-form",loading:i,children:t==="create"?"Create Page":"Save Changes"})})]})};export{ut as F};
